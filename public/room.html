<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/room.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    </head>
    <body>
        <div class="side-bar">
            <img class="logo" src="images/uau.png">
            <div class="nomeChat">Bem vindo<br/>ao nosso chat!</div>
            
            <div class="cantoDireito">
                <div class="nomeSala">
                    Você está na sala:<br/>
                    <strong>Sala01</strong>
                </div>
                <div class="sair"></div>
            </div>
        </div>
        <div id="historico" class="caixaHistorico">
            <div class="message">
                <div class="horaMsg">(15:10:10)</div>
                <div class="remetente">Usuario1</div>
                <div class="falouPara">disse:</div>                
                <div class="msg">Olá tudo bem?</div>
            </div>

        </div>
        <div class="caixaUsuarios">
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
            <div class="cadaUsuario">
                <div class="iconeDialogo"></div>
                <div class="nomeUsuario">Usuario 1</div>
            </div>
        </div>
        <div class="caixaMensagem">
            <div class="nomeUsuarioRemetente">
                Conectado como:<br/><strong>nomeDoUsuario</strong>
            </div>
            <input id="message_area" class="form-control" type="text" placeholder="Mensagem" required style="width: 75%; margin-top: 25px; display: inline">
            <button id="Send" type="submit" class="btn btn-primary" style="width: 10%; float: right; margin-top: 26px; margin-right: 10px">Enviar</button>
        </div>
    </body>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
        $(document).ready(function(){      

            var nickname = prompt("Digite seu apelido: ");
            
            var url = window.location.pathname;
            var room = url.split("/").slice(-1)[0];
            var socket = io.connect();

            socket.emit('join_room', room);
    

            socket.on('message', function(data){
                alert(data);
            });

            socket.on('update_chat', function(data){
                var message = JSON.parse(data);
                var new_div = document.createElement('div');
                new_div.className = "message";
                new_div.innerHTML = '<div class=horaMsg>(' + new Date().toLocaleString() + ')</div><div class="remetente">' + message.nickname + '</div><div class="falouPara">disse:</div><div class="msg">' +  message.message + '</div></div>';
                var parent = document.getElementById('historico');
                //$('.historico').appendChild(new_div);
                parent.appendChild(new_div);
                //var div = document.getElementById('test');
                //div.html(data.message);
            });
    

//            function send_message(){
//                var message = document.getElementById('message_area').value;
                //var message_body = '<div id="test" class="message"><div class=horaMsg>(15:10:10)</div><div class="remetente">Usuario1</div><div class="falouPara">disse</div><div class="msg">"' +  message + '</div></div>';
//
//                socket.emit('message', JSON.stringify({message: message_body, room: room}));
//                //alert('message sent!' + message);
//            }

            document.querySelector('#message_area').addEventListener('keypress', function (e) {
                var key = e.which || e.keyCode;
                if (key === 13) {
                    send_message();                    
                }
            });

            document.getElementById('Send').addEventListener("click", function(){
                send_message();
            });

            function send_message(){
                var message = document.getElementById('message_area').value;
                socket.emit('message', JSON.stringify({nickname: nickname, message: message, room: room}));

                document.getElementById('message_area').value = "";
            }

        });

    </script>
</html>
